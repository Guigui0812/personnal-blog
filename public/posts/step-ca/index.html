<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Step CA : devenir sa propre autorité de certification TLS | grohee</title>
<meta name=keywords content><meta name=description content="Dans un environnement fermé comme un homelab, il est commun d&rsquo;avoir recours à des certificats autosignés, ce qui n&rsquo;est jamais idéal. Step CA permet de devenir sa propre autorité de certification, de manière simple, sécurisée et automatisable.
Mise en place de la CA
Installation
Installer la CLI selon l&rsquo;architecture, par exemple armv7 :
wget https://dl.smallstep.com/gh-release/cli/gh-release-header/v0.28.6/step_linux_0.28.6_armv7.tar.gz

tar -xf step_linux_0.28.6_armv7.tar.gz
sudo mv step*/step /usr/local/bin/
Voir les différentes versions disponibles : GitHub - smallstep/cli"><meta name=author content><link rel=canonical href=https://guillaume-rohee.fr/posts/step-ca/><link crossorigin=anonymous href=/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF+13Dyqob6ASlTrTye8=" rel="preload stylesheet" as=style><link rel=icon href=https://guillaume-rohee.fr/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://guillaume-rohee.fr/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://guillaume-rohee.fr/favicon-32x32.png><link rel=apple-touch-icon href=https://guillaume-rohee.fr/apple-touch-icon.png><link rel=mask-icon href=https://guillaume-rohee.fr/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://guillaume-rohee.fr/posts/step-ca/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:url" content="https://guillaume-rohee.fr/posts/step-ca/"><meta property="og:site_name" content="grohee"><meta property="og:title" content="Step CA : devenir sa propre autorité de certification TLS"><meta property="og:description" content="Dans un environnement fermé comme un homelab, il est commun d’avoir recours à des certificats autosignés, ce qui n’est jamais idéal. Step CA permet de devenir sa propre autorité de certification, de manière simple, sécurisée et automatisable.
Mise en place de la CA Installation Installer la CLI selon l’architecture, par exemple armv7 :
wget https://dl.smallstep.com/gh-release/cli/gh-release-header/v0.28.6/step_linux_0.28.6_armv7.tar.gz tar -xf step_linux_0.28.6_armv7.tar.gz sudo mv step*/step /usr/local/bin/ Voir les différentes versions disponibles : GitHub - smallstep/cli"><meta property="og:locale" content="fr"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-03-21T18:00:00+01:00"><meta property="article:modified_time" content="2025-03-21T18:00:00+01:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Step CA : devenir sa propre autorité de certification TLS"><meta name=twitter:description content="Dans un environnement fermé comme un homelab, il est commun d&rsquo;avoir recours à des certificats autosignés, ce qui n&rsquo;est jamais idéal. Step CA permet de devenir sa propre autorité de certification, de manière simple, sécurisée et automatisable.
Mise en place de la CA
Installation
Installer la CLI selon l&rsquo;architecture, par exemple armv7 :
wget https://dl.smallstep.com/gh-release/cli/gh-release-header/v0.28.6/step_linux_0.28.6_armv7.tar.gz

tar -xf step_linux_0.28.6_armv7.tar.gz
sudo mv step*/step /usr/local/bin/
Voir les différentes versions disponibles : GitHub - smallstep/cli"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://guillaume-rohee.fr/posts/"},{"@type":"ListItem","position":2,"name":"Step CA : devenir sa propre autorité de certification TLS","item":"https://guillaume-rohee.fr/posts/step-ca/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Step CA : devenir sa propre autorité de certification TLS","name":"Step CA : devenir sa propre autorité de certification TLS","description":"Dans un environnement fermé comme un homelab, il est commun d\u0026rsquo;avoir recours à des certificats autosignés, ce qui n\u0026rsquo;est jamais idéal. Step CA permet de devenir sa propre autorité de certification, de manière simple, sécurisée et automatisable.\nMise en place de la CA Installation Installer la CLI selon l\u0026rsquo;architecture, par exemple armv7 :\nwget https://dl.smallstep.com/gh-release/cli/gh-release-header/v0.28.6/step_linux_0.28.6_armv7.tar.gz tar -xf step_linux_0.28.6_armv7.tar.gz sudo mv step*/step /usr/local/bin/ Voir les différentes versions disponibles : GitHub - smallstep/cli\n","keywords":[],"articleBody":"Dans un environnement fermé comme un homelab, il est commun d’avoir recours à des certificats autosignés, ce qui n’est jamais idéal. Step CA permet de devenir sa propre autorité de certification, de manière simple, sécurisée et automatisable.\nMise en place de la CA Installation Installer la CLI selon l’architecture, par exemple armv7 :\nwget https://dl.smallstep.com/gh-release/cli/gh-release-header/v0.28.6/step_linux_0.28.6_armv7.tar.gz tar -xf step_linux_0.28.6_armv7.tar.gz sudo mv step*/step /usr/local/bin/ Voir les différentes versions disponibles : GitHub - smallstep/cli\nTélécharger et exécuter l’image :\ndocker pull smallstep/step-ca docker run -it -u -v ./data:/home/step smallstep/step-ca step ca init Remplir les différents champs proposés :\n✔ What would you like to name your new PKI? (e.g. Smallstep): Smallstep ✔ What DNS names or IP addresses would you like to add to your new CA? (e.g. ca.smallstep.com[,1.1.1.1,etc.]): localhost ✔ What address will your new CA listen at? (e.g. :443): :9000 ✔ What would you like to name the first provisioner for your new CA? (e.g. you@smallstep.com): admin@smallstep.com ✔ What do you want your password to be? [leave empty and we'll generate one]: Explications :\nNom de la CA Nom DNS pris en compte Port d’écoute de la CA (9000 par défaut) Nom de l’admin de la CA Mot de passe Dans le volume $PATH/data monté dans le conteneur step-ca, créez le fichier ./data/secrets/password et ajoutez le mot de passe de la CA. Cette étape est obligatoire pour le démarrage du conteneur.\nEnsuite, il suffira d’exécuter le conteneur de la CA :\ndocker run -d -u -p 9000:9000 -v ./data:/home/step smallstep/step-ca Cas particulier sur Raspberry pi où une erreur s’affiche :\nbadger 2025/03/19 18:53:50 INFO: All 0 tables opened in 0s Error opening database of Type badgerv2: error opening Badger database: During db.vlog.open: Error while creating log file in valueLog.open: Mmap value log file. Path=/home/step/db/000000.vlog. Error=cannot allocate memory La Solution est d’éditer le fichier config/ca.json dans le volume avec vim et de modifier les lignes qui concernent la base de données :\n{ ... \"db\": { \"type\": \"badgerv2\", \"dataSource\": \"/home/step/db\", \"badgerFileLoadingMode\": \"FileIO\" }, ... } Cela est également possible via docker compose :\nservices: step-ca: user: \" image: smallstep/step-ca ports: - 9000:9000 restart: always volumes: - ./data:/home/step Récupérer la CA Récupérez la CA sur l’hôte docker (présente aussi sous $step-ca-path/data/certs/) :\nCA_FINGERPRINT=$(docker run -u -v ./data:/home/step smallstep/step-ca step certificate fingerprint /home/step/certs/root_ca.crt) step ca bootstrap --ca-url https://localhost:9000 --fingerprint $CA_FINGERPRINT Ajouter le certificat Root CA au système Sous Linux (Debian, Ubuntu) :\nsudo cp ~/step-ca-root.crt /usr/local/share/ca-certificates/step-ca.crt sudo update-ca-certificates Sous RHEL, Centos ou Fedora :\nsudo cp ~/step-ca-root.crt /etc/pki/ca-trust/source/anchors/step-ca.crt sudo update-ca-trust Sous macOS :\nsudo security add-trusted-cert -d -r trustRoot -k /Library/Keychains/System.keychain ~/step-ca-root.crt Sous Windows :\nOuvrir certlm.msc (via Win + R) Se rendre dans “Autorités de certification racines de confiance” et “Certificats”. Via clic droit → “Toutes les tâches” puis “Importer”. Sélectionner le fichier de la Root CA puis valider. Vérification Après l’ajout du certificat, il reste à tester le bon fonctionnement de la CA :\ncurl -v https://localhost:9000 Réponse attendue :\n{\"status\":\"ok\"} Obtenir un certificat depuis la CA Afin d’obtenir un certificat depuis la CA on utilise :\nstep ca certificate svc.example.com svc.crt svc.key Cette commande génère une clé privée (.key) et un certificat (.crt) signé par la CA.\nPar défaut les certificats ne sont valides que 24 heures. Pour augmenter la durée de validité, il faut ajouter le paramètre suivant dans config/ca.json :\n\"authority\": { \"provisioners\": [ ... ], \"claims\": { \"minTLSCertDuration\": \"5m\", \"maxTLSCertDuration\": \"2190h\", \"defaultTLSCertDuration\": \"2190h\" } } La validité doit être définie en heures : 2190h équivaut à 3 mois.\nRenouveler un certificat Renouvellement manuel Lorsqu’il est expiré, on peut renouveler un certificat avec la commande suivante :\nstep ca renew svc.crt svc.key Il est possible de renouvellement un certificat en forçant la réécriture des fichiers .crt et .key :\nstep ca renew --force svc.crt svc.key Renouvellement automatique Renouvellement via un daemon Utilisation de la commande suivante :\nstep ca renew --daemon --renew-period 24h svc.crt svc.key D’autres techniques seront abordées prochainement pour automatiser le renouvellement des certificats :\nRenouvellement via un cron ACME (Automated Certificate Management Environment) Références Run a private online TLS certificate authority in a Docker container Install step hub.docker.com/r/smallstep/step-ca GitHub - dogukancagatay/step-ca-example: step-ca ACME server example with Traefik Automated Local TLS Certificates With Step-CA | Tech Tutorials ","wordCount":"703","inLanguage":"en","datePublished":"2025-03-21T18:00:00+01:00","dateModified":"2025-03-21T18:00:00+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://guillaume-rohee.fr/posts/step-ca/"},"publisher":{"@type":"Organization","name":"grohee","logo":{"@type":"ImageObject","url":"https://guillaume-rohee.fr/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://guillaume-rohee.fr/ accesskey=h title="grohee (Alt + H)">grohee</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://guillaume-rohee.fr/categories/ title=Catégories><span>Catégories</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://guillaume-rohee.fr/>Home</a>&nbsp;»&nbsp;<a href=https://guillaume-rohee.fr/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Step CA : devenir sa propre autorité de certification TLS</h1><div class=post-meta><span title='2025-03-21 18:00:00 +0100 CET'>March 21, 2025</span>&nbsp;·&nbsp;703 words</div></header><div class=post-content><p>Dans un environnement fermé comme un <strong>homelab</strong>, il est commun d&rsquo;avoir recours à des <strong>certificats autosignés</strong>, ce qui n&rsquo;est jamais idéal. <strong>Step CA</strong> permet de devenir sa propre autorité de certification, de manière simple, sécurisée et automatisable.</p><h2 id=mise-en-place-de-la-ca>Mise en place de la CA<a hidden class=anchor aria-hidden=true href=#mise-en-place-de-la-ca>#</a></h2><h3 id=installation>Installation<a hidden class=anchor aria-hidden=true href=#installation>#</a></h3><p>Installer la <strong>CLI</strong> selon l&rsquo;architecture, par exemple <strong>armv7</strong> :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>wget https://dl.smallstep.com/gh-release/cli/gh-release-header/v0.28.6/step_linux_0.28.6_armv7.tar.gz
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>tar -xf step_linux_0.28.6_armv7.tar.gz
</span></span><span style=display:flex><span>sudo mv step*/step /usr/local/bin/
</span></span></code></pre></div><p><em>Voir les différentes versions disponibles</em> : <a href=https://github.com/smallstep/cli>GitHub - smallstep/cli</a></p><p>Télécharger et exécuter l&rsquo;image :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker pull smallstep/step-ca
</span></span><span style=display:flex><span>docker run -it -u &lt;step_ca_user_id&gt; -v ./data:/home/step smallstep/step-ca step ca init
</span></span></code></pre></div><p>Remplir les différents champs proposés :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>✔ What would you like to name your new PKI? (e.g. Smallstep)</span>: <span style=color:#ae81ff>Smallstep</span>
</span></span><span style=display:flex><span><span style=color:#f92672>✔ What DNS names or IP addresses would you like to add to your new CA? (e.g. ca.smallstep.com[,1.1.1.1,etc.])</span>: <span style=color:#ae81ff>localhost</span>
</span></span><span style=display:flex><span><span style=color:#f92672>✔ What address will your new CA listen at? (e.g. :443)</span>: :<span style=color:#ae81ff>9000</span>
</span></span><span style=display:flex><span><span style=color:#f92672>✔ What would you like to name the first provisioner for your new CA? (e.g. you@smallstep.com)</span>: <span style=color:#ae81ff>admin@smallstep.com</span>
</span></span><span style=display:flex><span><span style=color:#f92672>✔ What do you want your password to be? [leave empty and we&#39;ll generate one]</span>:
</span></span></code></pre></div><p>Explications :</p><ul><li>Nom de la CA</li><li>Nom DNS pris en compte</li><li>Port d&rsquo;écoute de la CA (9000 par défaut)</li><li>Nom de l&rsquo;admin de la CA</li><li>Mot de passe</li></ul><p>Dans le volume <code>$PATH/data</code> monté dans le conteneur <code>step-ca</code>, créez le fichier <code>./data/secrets/password</code> et ajoutez le mot de passe de la <strong>CA</strong>. Cette étape est obligatoire pour le démarrage du conteneur.</p><p>Ensuite, il suffira d&rsquo;exécuter le conteneur de la <strong>CA</strong> :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>docker run -d -u &lt;step-ca_user_id&gt; -p 9000:9000 -v ./data:/home/step smallstep/step-ca
</span></span></code></pre></div><p><strong>Cas particulier sur Raspberry pi où une erreur s&rsquo;affiche</strong> :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>badger 2025/03/19 18:53:50 INFO: All <span style=color:#ae81ff>0</span> tables opened in 0s
</span></span><span style=display:flex><span>Error opening database of Type badgerv2: error opening Badger database: During db.vlog.open: Error <span style=color:#66d9ef>while</span> creating log file in valueLog.open: Mmap value log file. Path<span style=color:#f92672>=</span>/home/step/db/000000.vlog. Error<span style=color:#f92672>=</span>cannot allocate memory
</span></span></code></pre></div><p>La <strong>Solution</strong> est d&rsquo;éditer le fichier <code>config/ca.json</code> dans le volume avec <code>vim</code> et de modifier les lignes qui concernent la <strong>base de données</strong> :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>...</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;db&#34;</span>: {
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;type&#34;</span>: <span style=color:#e6db74>&#34;badgerv2&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;dataSource&#34;</span>: <span style=color:#e6db74>&#34;/home/step/db&#34;</span>,
</span></span><span style=display:flex><span>          <span style=color:#f92672>&#34;badgerFileLoadingMode&#34;</span>: <span style=color:#e6db74>&#34;FileIO&#34;</span>
</span></span><span style=display:flex><span>    },
</span></span><span style=display:flex><span><span style=color:#960050;background-color:#1e0010>...</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Cela est également possible via <code>docker compose</code> :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>services</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>step-ca</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>user</span>: <span style=color:#ae81ff>&#34;&lt;step-ca_user_id&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>image</span>: <span style=color:#ae81ff>smallstep/step-ca</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>ports</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>9000</span>:<span style=color:#ae81ff>9000</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>restart</span>: <span style=color:#ae81ff>always</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>volumes</span>:
</span></span><span style=display:flex><span>      - <span style=color:#ae81ff>./data:/home/step</span>
</span></span></code></pre></div><h3 id=récupérer-la-ca>Récupérer la CA<a hidden class=anchor aria-hidden=true href=#récupérer-la-ca>#</a></h3><p>Récupérez la <strong>CA</strong> sur l&rsquo;hôte <strong>docker</strong> (présente aussi sous <code>$step-ca-path/data/certs/</code>) :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>CA_FINGERPRINT<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>docker run -u &lt;step-ca_user_id&gt; -v ./data:/home/step smallstep/step-ca step certificate fingerprint /home/step/certs/root_ca.crt<span style=color:#66d9ef>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>step ca bootstrap --ca-url https://localhost:9000 --fingerprint $CA_FINGERPRINT
</span></span></code></pre></div><h3 id=ajouter-le-certificat-root-ca-au-système>Ajouter le certificat <strong>Root CA</strong> au système<a hidden class=anchor aria-hidden=true href=#ajouter-le-certificat-root-ca-au-système>#</a></h3><p><strong>Sous Linux (Debian, Ubuntu) :</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo cp ~/step-ca-root.crt /usr/local/share/ca-certificates/step-ca.crt
</span></span><span style=display:flex><span>sudo update-ca-certificates
</span></span></code></pre></div><p><strong>Sous RHEL, Centos ou Fedora :</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo cp ~/step-ca-root.crt /etc/pki/ca-trust/source/anchors/step-ca.crt
</span></span><span style=display:flex><span>sudo update-ca-trust
</span></span></code></pre></div><p><strong>Sous macOS :</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>sudo security add-trusted-cert -d -r trustRoot -k /Library/Keychains/System.keychain ~/step-ca-root.crt
</span></span></code></pre></div><p><strong>Sous Windows :</strong></p><ul><li>Ouvrir <code>certlm.msc</code> (via <code>Win + R</code>)</li><li>Se rendre dans <strong>&ldquo;Autorités de certification racines de confiance&rdquo;</strong> et <strong>&ldquo;Certificats&rdquo;</strong>.</li><li>Via clic droit → <strong>&ldquo;Toutes les tâches&rdquo;</strong> puis <strong>&ldquo;Importer&rdquo;</strong>.</li><li>Sélectionner le fichier de la <strong>Root CA</strong> puis valider.</li></ul><h3 id=vérification>Vérification<a hidden class=anchor aria-hidden=true href=#vérification>#</a></h3><p>Après l&rsquo;ajout du certificat, il reste à tester le bon fonctionnement de la <strong>CA</strong> :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>curl -v https://localhost:9000
</span></span></code></pre></div><p>Réponse attendue :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;status&#34;</span>:<span style=color:#e6db74>&#34;ok&#34;</span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h2 id=obtenir-un-certificat-depuis-la-ca>Obtenir un certificat depuis la CA<a hidden class=anchor aria-hidden=true href=#obtenir-un-certificat-depuis-la-ca>#</a></h2><p>Afin d&rsquo;obtenir un <strong>certificat</strong> depuis la <strong>CA</strong> on utilise :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>step ca certificate svc.example.com svc.crt svc.key
</span></span></code></pre></div><p>Cette commande génère une clé privée (<code>.key</code>) et un certificat (<code>.crt</code>) signé par la CA.</p><p>Par défaut les certificats ne sont valides que <strong>24 heures</strong>. Pour augmenter la durée de validité, il faut ajouter le paramètre suivant dans <code>config/ca.json</code> :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span> <span style=color:#e6db74>&#34;authority&#34;</span><span style=color:#960050;background-color:#1e0010>:</span> {
</span></span><span style=display:flex><span>	<span style=color:#f92672>&#34;provisioners&#34;</span>: [
</span></span><span style=display:flex><span>		<span style=color:#960050;background-color:#1e0010>...</span>        
</span></span><span style=display:flex><span>	],
</span></span><span style=display:flex><span>	<span style=color:#f92672>&#34;claims&#34;</span>: {
</span></span><span style=display:flex><span>		<span style=color:#f92672>&#34;minTLSCertDuration&#34;</span>: <span style=color:#e6db74>&#34;5m&#34;</span>,
</span></span><span style=display:flex><span>		<span style=color:#f92672>&#34;maxTLSCertDuration&#34;</span>: <span style=color:#e6db74>&#34;2190h&#34;</span>,
</span></span><span style=display:flex><span>		<span style=color:#f92672>&#34;defaultTLSCertDuration&#34;</span>: <span style=color:#e6db74>&#34;2190h&#34;</span>
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>La validité doit être définie en <strong>heures</strong> : <code>2190h</code> équivaut à <strong>3 mois</strong>.</p><h2 id=renouveler-un-certificat>Renouveler un certificat<a hidden class=anchor aria-hidden=true href=#renouveler-un-certificat>#</a></h2><h3 id=renouvellement-manuel>Renouvellement manuel<a hidden class=anchor aria-hidden=true href=#renouvellement-manuel>#</a></h3><p>Lorsqu&rsquo;il est expiré, on peut renouveler un certificat avec la commande suivante :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>step ca renew svc.crt svc.key
</span></span></code></pre></div><p>Il est possible de renouvellement un certificat en forçant la réécriture des fichiers <code>.crt</code> et <code>.key</code> :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>step ca renew --force svc.crt svc.key
</span></span></code></pre></div><h3 id=renouvellement-automatique>Renouvellement automatique<a hidden class=anchor aria-hidden=true href=#renouvellement-automatique>#</a></h3><h4 id=renouvellement-via-un-daemon>Renouvellement via un <strong>daemon</strong><a hidden class=anchor aria-hidden=true href=#renouvellement-via-un-daemon>#</a></h4><p>Utilisation de la commande suivante :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>step ca renew --daemon --renew-period 24h svc.crt svc.key
</span></span></code></pre></div><p>D&rsquo;autres techniques seront abordées prochainement pour automatiser le renouvellement des certificats :</p><ul><li>Renouvellement via un <strong>cron</strong></li><li><strong>ACME</strong> (Automated Certificate Management Environment)</li></ul><h2 id=références>Références<a hidden class=anchor aria-hidden=true href=#références>#</a></h2><ul><li><a href=https://smallstep.com/docs/tutorials/docker-tls-certificate-authority/#troubleshooting>Run a private online TLS certificate authority in a Docker container</a></li><li><a href=https://smallstep.com/docs/step-cli/installation/#debian-ubuntu>Install step</a></li><li><a href=https://hub.docker.com/r/smallstep/step-ca>hub.docker.com/r/smallstep/step-ca</a></li><li><a href=https://github.com/dogukancagatay/step-ca-example>GitHub - dogukancagatay/step-ca-example: step-ca ACME server example with Traefik</a></li><li><a href=https://www.techtutorials.tv/sections/it-security/automated-tls-certificates-step-ca/>Automated Local TLS Certificates With Step-CA | Tech Tutorials</a></li></ul></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://guillaume-rohee.fr/>grohee</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>