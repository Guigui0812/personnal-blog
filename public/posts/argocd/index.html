<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Argo CD et GitOps : automatiser le déploiement Kubernetes | grohee</title>
<meta name=keywords content><meta name=description content="Argo CD est un outil de déploiement continu spécifiquement conçu pour les environnements Kubernetes. Fonctionnant selon le principe du GitOps, il permet de simplifier et d&rsquo;automatiser le déploiement d&rsquo;applications et la gestion d&rsquo;infrastructures conteneurisées en s&rsquo;appuyant sur des dépôts Git comme source de vérité.
Le GitOps
C&rsquo;est une méthodologie liée au déploiement d&rsquo;applications et à la gestion automatisée d&rsquo;infrastructure. Elle consiste à gérer l&rsquo;infrastructure en tant que code, sous forme de fichiers (souvent au format YAML) stockés dans des dépôts git utilisés comme source de vérité. L&rsquo;intérêt est de garantir que l&rsquo;état de l&rsquo;infrastructure et des applications est toujours en phase avec la configuration définie dans le dépôt."><meta name=author content><link rel=canonical href=https://grohee.fr/posts/argocd/><link crossorigin=anonymous href=/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF+13Dyqob6ASlTrTye8=" rel="preload stylesheet" as=style><link rel=icon href=https://grohee.fr/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://grohee.fr/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://grohee.fr/favicon-32x32.png><link rel=apple-touch-icon href=https://grohee.fr/apple-touch-icon.png><link rel=mask-icon href=https://grohee.fr/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://grohee.fr/posts/argocd/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:url" content="https://grohee.fr/posts/argocd/"><meta property="og:site_name" content="grohee"><meta property="og:title" content="Argo CD et GitOps : automatiser le déploiement Kubernetes"><meta property="og:description" content="Argo CD est un outil de déploiement continu spécifiquement conçu pour les environnements Kubernetes. Fonctionnant selon le principe du GitOps, il permet de simplifier et d’automatiser le déploiement d’applications et la gestion d’infrastructures conteneurisées en s’appuyant sur des dépôts Git comme source de vérité.
Le GitOps C’est une méthodologie liée au déploiement d’applications et à la gestion automatisée d’infrastructure. Elle consiste à gérer l’infrastructure en tant que code, sous forme de fichiers (souvent au format YAML) stockés dans des dépôts git utilisés comme source de vérité. L’intérêt est de garantir que l’état de l’infrastructure et des applications est toujours en phase avec la configuration définie dans le dépôt."><meta property="og:locale" content="fr"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-05-26T20:00:00+01:00"><meta property="article:modified_time" content="2025-05-26T20:00:00+01:00"><meta property="og:image" content="https://grohee.fr/images/argocd.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://grohee.fr/images/argocd.png"><meta name=twitter:title content="Argo CD et GitOps : automatiser le déploiement Kubernetes"><meta name=twitter:description content="Argo CD est un outil de déploiement continu spécifiquement conçu pour les environnements Kubernetes. Fonctionnant selon le principe du GitOps, il permet de simplifier et d&rsquo;automatiser le déploiement d&rsquo;applications et la gestion d&rsquo;infrastructures conteneurisées en s&rsquo;appuyant sur des dépôts Git comme source de vérité.
Le GitOps
C&rsquo;est une méthodologie liée au déploiement d&rsquo;applications et à la gestion automatisée d&rsquo;infrastructure. Elle consiste à gérer l&rsquo;infrastructure en tant que code, sous forme de fichiers (souvent au format YAML) stockés dans des dépôts git utilisés comme source de vérité. L&rsquo;intérêt est de garantir que l&rsquo;état de l&rsquo;infrastructure et des applications est toujours en phase avec la configuration définie dans le dépôt."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://grohee.fr/posts/"},{"@type":"ListItem","position":2,"name":"Argo CD et GitOps : automatiser le déploiement Kubernetes","item":"https://grohee.fr/posts/argocd/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Argo CD et GitOps : automatiser le déploiement Kubernetes","name":"Argo CD et GitOps : automatiser le déploiement Kubernetes","description":"Argo CD est un outil de déploiement continu spécifiquement conçu pour les environnements Kubernetes. Fonctionnant selon le principe du GitOps, il permet de simplifier et d\u0026rsquo;automatiser le déploiement d\u0026rsquo;applications et la gestion d\u0026rsquo;infrastructures conteneurisées en s\u0026rsquo;appuyant sur des dépôts Git comme source de vérité.\nLe GitOps C\u0026rsquo;est une méthodologie liée au déploiement d\u0026rsquo;applications et à la gestion automatisée d\u0026rsquo;infrastructure. Elle consiste à gérer l\u0026rsquo;infrastructure en tant que code, sous forme de fichiers (souvent au format YAML) stockés dans des dépôts git utilisés comme source de vérité. L\u0026rsquo;intérêt est de garantir que l\u0026rsquo;état de l\u0026rsquo;infrastructure et des applications est toujours en phase avec la configuration définie dans le dépôt.\n","keywords":[],"articleBody":"Argo CD est un outil de déploiement continu spécifiquement conçu pour les environnements Kubernetes. Fonctionnant selon le principe du GitOps, il permet de simplifier et d’automatiser le déploiement d’applications et la gestion d’infrastructures conteneurisées en s’appuyant sur des dépôts Git comme source de vérité.\nLe GitOps C’est une méthodologie liée au déploiement d’applications et à la gestion automatisée d’infrastructure. Elle consiste à gérer l’infrastructure en tant que code, sous forme de fichiers (souvent au format YAML) stockés dans des dépôts git utilisés comme source de vérité. L’intérêt est de garantir que l’état de l’infrastructure et des applications est toujours en phase avec la configuration définie dans le dépôt.\nIl existe plusieurs “modes” de GitOps nommés push et pull :\nMode push : Cas où c’est la modification du référentiel qui provoque la livraison d’une nouvelle configuration afin de placer l’infrastructure dans l’état souhaité. Par exemple, une pipeline (Jenkins, GitLab CI…) déclenche l’application de la configuration après une modification dans Git. Mode pull : un agent (ex : Argo CD, Flux) scrute le dépôt Git en continu et applique les changements dès qu’ils sont détectés. Les modifications sont apportées automatiquement par l’outil sans autre intervention humaine que la modification du référentiel. Remarques :\nLeGitOps ne remplace pas l’usage d’une CI classique pour les étapes de test ou de build d’images, il s’agit plutôt d’une approche de Déploiement Continu (CD). L’approche pull est plus robuste, mieux adaptée à Kubernetes, et permet une synchronisation continue sans intervention manuelle. Important : Dans une approche pull l’utilisation des fonctionnalités de Merge Request afin d’effectuer une relecture et une validation des modifications est recommandée.\nArgo CD : principes et fonctionnalités Argo CD est un outil de la catégorie pull. Il permet de gérer le déploiement d’applications et la configuration de clusters Kubernetes en se basant sur diverses sources : Git, Helm ou encore Kustomize.\nSon principe de fonctionnement est le suivant : il scrute en permanence les dépôts Git enregistrés en tant que sources afin de détecter des modifications et appliquer automatiquement les changements correspondant à la configuration du cluster Kubernetes et des applications qu’il héberge.\nFonctionnalités Déploiement \u0026 synchronisation : Argo déploie les ressources sur le cluster Kubernetes en se basant sur la configuration définie dans le dépôt Git. Il s’assure que l’état du cluster correspond à l’état souhaité défini dans le dépôt en intéragissant avec l’API Kubernetes. Custom Resource Definitions (CRD) : Argo CD intègre ses propres ressources personnalisées (CRD) pour gérer l’ensemble des configurations de l’outil en tant que code. Quelques exemples de CRD : Application : représente une application déployée sur le cluster. AppProject : permet de définir des projets d’application, facilitant la gestion des autorisations et des ressources. ApplicationSet : permet de déployer plusieurs applications à partir d’un modèle ou d’une configuration commune. UI Web : interface web intuitive pour visualiser l’état des applications, gérer les déploiements, effectuer des opérations de synchronisation et même consulter les logs des pods. Authentification et SSO : Argo CD prend en charge plusieurs méthodes d’authentification, y compris l’intégration avec des systèmes d’authentification tiers via OpenID Connect (OIDC) ou LDAP. Gestion des accès : Argo CD embarque un système de gestion de permissions basé sur les rôles (RBAC) permettant de contrôler l’accès aux ressources et aux fonctionnalités de l’outil. Métriques et alertes : Argo CD expose des métriques Prometheus pour surveiller l’état des applications et des clusters. Il est possible de configurer des alertes basées sur ces métriques. Gestion multi-cluster : possibilité de gérer plusieurs clusters Kubernetes à partir d’une seule instance, facilitant ainsi la gestion d’environnements complexes. Intégration avec des Webhooks : Argo CD peut être configuré pour recevoir des notifications de changements dans les dépôts Git via des webhooks, permettant ainsi une synchronisation instantanée des modifications. Gestion des secrets : gestion des secrets Kubernetes Fonctionnement et architecture Argo CD est un ensemble de composants qui sont déployés sur le cluster Kubernetes sous forme de microservices. Voici les principaux composants et leur fonction :\nL’API Server :\nExpose l’API utilisée par l’interface web et la CLI d’ArgoCD Gestion des applications et la récupération de leur statut Exécution des opérations telles que la synchronisation, le retour en arrière et les actions définies par l’utilisateur Gestion des identifiants des dépôts et des clusters, qui sont stockés en tant que Secrets Kubernetes Le Repository Server :\nStocke les informations sur les dépôts git: URL, version, chemin vers la définition de l’application Mise en cache des manifestes d’application pour une récupération rapide L’Application Controller :\nSurveille l’état des applications déployées sur le cluster Compare l’état actuel des applications à l’état cible défini dans le dépôt Prend des mesures correctives en cas de détection d’états OutOfSync ou de changement dans la source (via le controller manager de K8s) Gère les événements définis par l’utilisateur relatifs au cycle de vie de l’application (PreSync, Sync et PostSync) D’autres composants sont présents comme l’application set controller pour la gestion des ressources du même nom, ou dex pour la gestion des utilisateurs et de l’authentification.\nAvantages Centralisation des configurations dans un référentiel unique (git) Versionning des configurations d’infrastructure et possibilité de revenir à une version antérieure en cas de problème Garantit la cohérence entre l’état réel et l’état souhaité de l’infrastructure Éviter les modifications manuelles non tracées Fiabilisation des déploiements et limitation des erreurs humaines Aperçu de l’ensemble des ressources déployées dans le cluster via l’interface web Installation Méthode de base La première manière d’insaller Argo CD est de le déployer en suivant la documentation officielle.\nPour cela, il suffit d’appliquer le fichier manifest fournit par la documentation dans un namespace dédié :\nkubectl create namespace argocd kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml Une fois installé, il suffit de faire un port-forward sur le service argocd-server pour accéder à l’interface web :\nkubectl port-forward svc/argocd-server -n argocd 8080:443 --address 0.0.0.0 Une fois connecté sur l’interface web, il est possible de se connecter avec le nom d’utilisateur admin et le mot de passe par défaut qu’il est possible d’obtenir via la commande suivante :\nkubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath=\"{.data.password}\" | base64 -d Installation via Helm Dans le cas d’un environnement Kubernetes en production, il est souvent plus propre de déployer les ressources via un chart Helm. Il existe un grand nombre de charts pour tout type de services, et Argo CD n’échappe pas à la règle.\nL’installation via Helm s’effectue avec les commandes suivantes :\nhelm repo add argo https://argoproj.github.io/argo-helm # Ajout du dépôt Helm d'Argo helm install my-argo-cd argo/argo-cd -n argocd --create-namespace # Installation d'Argo dans le namespace Remarque : il peut être nécessaire de fixer la version du chart à installer en ajoutant --version à la commande helm install dans le cas d’environnements de production, afin d’éviter les changements de comportement suite à une mise à jour du chart.\nAstuce : si le dépôt Helm n’est pas déte, utiliser helm repo update.\nDans le cas d’une installation par Helm, il est possible de personnaliser la configuration de l’outil dès l’installation via des values.\nPar exemple, il est possible de désactiver tls sur le serveur argocd-server :\nconfigs: params: server.insecure: \"true\" Ces éléments sont à ajouter dans un fichier values.yaml et à passer lors de l’installation :\nhelm install my-argo-cd argo/argo-cd -n argocd --create-namespace -f values.yaml L’ensemble des valeurs configurables sont détaillées dans le dépôt git du projet argo-helm.\nRemarque : pour avoir un déploiement totalement automatisé et reproductible, il est possible d’utiliser le provider Helm pour Terraform.\nConfiguration Argo CD est un outil complet et riche en fonctionnalités : authentification, gestion des accès, gestion d’utilisateurs, gestion des applications, monitoring, etc.\nAuthentification Argo CD propose une grande variété de méthodes d’authentifications, allant de l’authentification basique (nom d’utilisateur et mot de passe) à l’intégration de OpenID Connect (OIDC) pour une authentification unique (SSO) avec des fournisseurs d’identité tels que Google, GitHub, Keycloak, LDAP, etc.\nLa plupart de ces fonctionnalités sont offertes par dex qui est un composant open source permettant de gérer l’authentification des utilisateurs.\nLDAP Il est possible de configurer Argo CD pour utiliser un annuaire LDAP afin d’y authentifier les utilisateurs et de gérer les groupes d’utilisateurs.\nExemple de configuration pour le connecteur LDAP :\napiVersion: v1 data: dex.config: | connectors: - type: ldap name: LDAP id: ldap config: # Ldap server address host: \"\" insecureNoSSL: true insecureSkipVerify: true # Variable name stores ldap bindDN in argocd-secret bindDN: \"$dex.ldap.bindDN\" # Variable name stores ldap bind password in argocd-secret bindPW: \"$dex.ldap.bindPW\" usernamePrompt: Username # Ldap user search attributes userSearch: baseDN: \"\" filter: \"\" username: sAMAccountName idAttr: sAMAccountName emailAttr: mail nameAttr: givenName # Ldap group search attributes groupSearch: baseDN: \"\" filter: \"(objectClass=group)\" userAttr: DN groupAttr: member nameAttr: cn url: https:// L’utilisation du connecteur LDAP de dex (Documentation dex) permet de configurer les paramètres de connexion à l’annuaire LDAP, les attributs des utilisateurs et des groupes, ainsi que les filtres de recherche (pour par exemple autoriser uniquement certains groupes d’utilisateurs à se connecter à Argo CD).\nOpenID Connect (OIDC) Google Grâce à dex, il est possible de configurer Argo CD pour utiliser Google comme fournisseur d’identité via OpenID Connect (OIDC).\nExemple de configuration :\napiVersion: v1 data: admin.enabled: \"true\" application.instanceLabelKey: argocd.argoproj.io/instance dex.config: | connectors: - config: issuer: https://accounts.google.com clientID: clientSecret: redirectURI: https:///api/dex/callback type: oidc id: google name: Google exec.enabled: \"false\" oidc.tls.insecure.skip.verify: \"true\" server.rbac.log.enforce.enable: \"false\" statusbadge.enabled: \"false\" timeout.hard.reconciliation: 0s timeout.reconciliation: 180s url: https:// kind: ConfigMap Quelques points à noter :\nLe clientID et le clientSecret sont à récupérer dans la console de gestion des APIs de Google Cloud. Le redirectURI doit correspondre à l’URL de votre instance Argo CD suivi de /api/dex/callback (représente le point de terminaison de redirection pour l’authentification OIDC). Plusieurs fournisseurs d’identité peuvent être configurés dans le même fichier de configuration dex.config. La récupération des groupes d’utilisateurs peut être configurée mais nécessite un compte de service avec une délégation au niveau de l’organisation pour accéder aux groupes d’utilisateurs dans Google Workspace. Ressource :\nConnecteur OIDC - Documentation dex Authentification avec Google - Argo CD Gestion des accès et permissions Les fournisseurs d’identité (ex : LDAP, OIDC) permettant la récupération des utilisateurs et des groupes, Argo CD permet à ses administrateurs de définir des rôles et des permissions pour contrôler l’accès aux ressources et aux fonctionnalités de l’outil.\nPlusieurs fonctionnalités vont permettre de gérer les politiques RBAC (Role-Based Access Control) :\nProjects : permettent de regrouper les applications et de définir des politiques globales pour toutes les applications d’un projet. Roles : définissent les permissions accordées aux utilisateurs ou groupes d’utilisateurs. Role Bindings : lient les rôles aux utilisateurs ou groupes d’utilisateurs, leur accordant ainsi les permissions définies dans le rôle. Policies : définissent les règles d’accès aux ressources et aux fonctionnalités d’Argo CD, en fonction des rôles et des utilisateurs. Projets Un projet dans Argo CD est une ressource qui se déclare d’une manière similaire à une application. La différence réside évidemment dans le contenu de la ressource qui permet de :\nDéfinir les namespaces sources et destination autorisés pour les applications du projet Définir les dépôts Git autorisés pour les applications du projet Définir des rôles et permissions spécifiques au projet Définir des fenêtres de maintenance pour les applications du projet : Permet de limiter les opérations de synchronisation pendant une période donnée (ex : pendant les heures de travail) Utile pour éviter les modifications pendant des périodes critiques (ex : maintenance, déploiement de nouvelles versions) Autoriser ou restreindre l’usage de certaines ressources Kubernetes (ex : ConfigMap, Secret, ServiceAccount, etc.) pour les applications du projet Aperçu du contenu d’un projet :\napiVersion: argoproj.io/v1alpha1 kind: AppProject metadata: name: example-app-project namespace: argocd spec: description: ArgoCD project for an example application sourceRepos: - '*' destinations: - namespace: server: https://kubernetes.default.svc - namespace: server: https://kubernetes.default.svc - namespace: \"!kube-system\" # Exclut le namespace kube-system server: \"*\" clusterResourceWhitelist: [] clusterResourceBlacklist: [] namespaceResourceBlacklist: - group: '' kind: ResourceQuota - group: '' kind: LimitRange - group: '' kind: NetworkPolicy orphanedResources: {} roles: [] namespaceResourceWhitelist: - group: 'apps' kind: Deployment - group: 'apps' kind: StatefulSet orphanedResources: {} roles: [] syncWindows: - kind: allow schedule: '10 1 * * *' duration: 1h applications: - '*-prod' manualSync: true signatureKeys: - keyID: ABCDEF1234567890 sourceNamespaces: - ${argocd_namespace} - ${argocd_namespace} Quelques explications :\norphanedResources : permet de définir les ressources orphelines (ressources qui ne sont plus gérées par Argo CD) à prendre en compte ou à ignorer lors de la synchronisation. signatureKeys : permet de définir les clés de signature utilisées pour vérifier l’intégrité des applications déployées. Plus d’informations dans la documentation de Argo CD.\nLes politiques de sécurité Les politiques de sécurité dans Argo CD permettent de définir des règles d’accès aux ressources et aux fonctionnalités de l’outil. Elles sont définies dans le fichier de configuration argocd-rbac-cm dans le namespace argocd.\nOn va pouvoir attribuer des rôles par défaut tels que admin et readonly, mais aussi définir des rôles personnalisés.\nChaque ressource (ex : Application, Project, ApplicationSet, etc.) possède des permissions spécifiques qui peuvent être accordées ou restreintes aux utilisateurs et groupes d’utilisateurs :\nRessource get create update delete sync action override invoke applications ✅ ✅ ✅ ✅ ✅ ✅ ✅ ❌ applicationsets ✅ ✅ ✅ ✅ ❌ ❌ ❌ ❌ clusters ✅ ✅ ✅ ✅ ❌ ❌ ❌ ❌ projects ✅ ✅ ✅ ✅ ❌ ❌ ❌ ❌ repositories ✅ ✅ ✅ ✅ ❌ ❌ ❌ ❌ accounts ✅ ❌ ✅ ❌ ❌ ❌ ❌ ❌ certificates ✅ ✅ ❌ ✅ ❌ ❌ ❌ ❌ gpgkeys ✅ ✅ ❌ ✅ ❌ ❌ ❌ ❌ logs ✅ ❌ ❌ ❌ ❌ ❌ ❌ ❌ exec ❌ ✅ ❌ ❌ ❌ ❌ ❌ ❌ extensions ❌ ❌ ❌ ❌ ❌ ❌ ❌ ✅ Tableau tiré de la documentation officielle\nDès lors, il est possible de définir des rôles et des permissions pour les utilisateurs et groupes en se basant sur ces différents types de droits pour chaque ressource.\nExemple de définition de rôle :\napiVersion: v1 kind: ConfigMap metadata: name: argocd-rbac-cm namespace: argocd labels: app.kubernetes.io/name: argocd-rbac-cm app.kubernetes.io/part-of: argocd data: policy.csv: | p, role:developer, applications, *, my-project/*, allow # Permet aux développeurs de gérer les applications de leur projet p, role:developer, applications, get,*, allow # Permet aux développeurs de récupérer les applications de tous les projets p, role:developer, applicationsets, get,*, allow # Permet aux développeurs de récupérer les ApplicationSets de tous les projets p, role:developer, repositories, get,*, allow # Permet aux développeurs de récupérer les dépôts de tous les projets p, role:developer, projects, get,*, allow # Permet aux développeurs de récupérer les projets de tous les projets p, role:developer, clusters, get,*, allow # Permet aux développeurs de récupérer les clusters de tous les projets g, developer@example, role:developer # Associe le groupe developer@example à ce rôle g, user@example.org, role:admin policy.default: role:readonly scopes: '[groups, email]' Remarque : Un rôle par défaut peut être définir avec policy.default et sera appliqué à tous les utilisateurs qui ne sont pas explicitement associés à un rôle.\nMonitoring A venir\nDéploiement d’applications Déployer une application simple Argo CD étant plutôt simple à utiliser, il est possible de déployer directement une application via l’interface web.\nOn retrouve deux méthodes de définition d’application :\nVia un formulaire web Via un éditeur de texte permettant de définir l’application en YAML Ces éléments permettent de créer la ressource Application qui contient toutes les informations nécessaires au déploiement de l’application, et à son suivi :\nSource : dépôt Git, Helm ou Kustomize. Destination : cluster Kubernetes et namespace cible Sync Policy et Sync Options : stratégie de synchronisation (automatique ou manuelle) et options de synchronisation (ex : prune, self heal) Project : projet auquel l’application appartient afin de gérer les accès et les ressources Concernant l’utilisation de l’interface web, les champs étant assez explicites, il est possible de créer une application en quelques clics.\nPour la création d’une application via un fichier YAML, voici un exemple de définition d’application :\napiVersion: argoproj.io/v1alpha1 kind: Application metadata: name: some-app # Nom de l'application namespace: argocd # Namespace où la ressource application sera créée spec: project: default # Projet par défaut source: repoURL: https://github.com/example-org/gitops-demo # URL du dépôt targetRevision: main # Branche path: apps/ # Chemin vers les fichiers de configuration destination: server: https://kubernetes.default.svc # URL de l'API du cluster (ici le cluster par défaut) namespace: app # Namespace cible syncPolicy: automated: # Synchronisation automatique prune: true # Prune les ressources non définies dans le dépôt (supprime les ressources non gérées par Argo CD) selfHeal: true # Auto-réparation des ressources syncOptions: - CreateNamespace=true - PruneLast=true # Prune les ressources après la synchronisation Il est possible d’utiliser des charts Helm comme source d’application. Dans ce cas, il faut ajouter la section helm dans la définition de l’application :\napiVersion: argoproj.io/v1alpha1 kind: Application metadata: name: kubernetes-dashboard namespace: argocd spec: project: default source: chart: kubernetes-dashboard repoURL: https://kubernetes.github.io/dashboard/ targetRevision: 7.10.0 helm: releaseName: kubernetes-dashboard values: | kong.admin.tls.enabled: false destination: server: \"https://kubernetes.default.svc\" namespace: monitoring syncPolicy: syncOptions: - CreateNamespace=true La personnalisation des values du chart Helm peut se faire de plusieurs manières :\nEn utilisant la section values ou valuesObject dans la définition de l’application (comme ci-dessus) En utilisant un fichier YAML externe (ex : values.yaml) en l’ajoutant dans la section valuesFiles. Plus d’informations sont disponibles dans la section Helm de la documentation.\nDéployer plusieurs applications App of Apps Bien qu’il soit possible d’utiliser l’interface web pour créer chaque application une à une, il est préférable de le faire via des fichiers YAML stockés dans un dépôt Git. Cela permet de versionner la configuration des applications et de les gérer comme n’importe quelle autre ressource Kubernetes.\nCe type d’implémentation est appelé App of Apps, c’est à dire qu’à partir d’une application Argo CD, une multitudes d’autres applications seront déployées car définies dans des fichiers YAML stockés dans un dépôt Git scruté par l’application racine.\nApplicationSet Une autre solution pour déployer plusieurs applications est d’utiliser un ApplicationSet. Il s’agit d’une ressource permettant de définir des templates d’applications et de générer plusieurs applications à partir de ceux-ci.\nOn va pouvoir les utiiliser dans plusieurs cas :\nDéployer plusieurs instances d’une même application avec des configurations différentes (ex : différents environnements) Déployer des applications à partir de modèles définis dans un dépôt Git Déployer des applications dans plusieurs clusters Exemple d’ApplicationSet basé sur un dépôt Git :\napiVersion: argoproj.io/v1alpha1 kind: ApplicationSet metadata: name: apps-by-dir namespace: argocd spec: generators: - git: repoURL: https://github.com/mon-org/mon-repo.git revision: main directories: - path: apps/* template: metadata: name: '{{path.basename}}' spec: project: default source: repoURL: https://github.com/mon-org/mon-repo.git targetRevision: main path: '{{path}}' destination: server: https://kubernetes.default.svc namespace: '{{path.basename}}' syncPolicy: automated: prune: true selfHeal: true De nombreux générateurs sont disponibles pour l’ApplicationSet et sont détaillés dans la documentation officielle.\nGestion des secrets A venir\nRéférences Documentation officielle d’Argo CD ArgoCD de A à Y - Une tasse de café Flux et ArgoCD, deux visions du GitOps sur Kubernetes - WeScale Argo CD, qu’est-ce que c’est ? - Red Hat ArgoCD Tutorial for Beginners | GitOps CD for Kubernetes - TechWorld with Nana ","wordCount":"3134","inLanguage":"en","image":"https://grohee.fr/images/argocd.png","datePublished":"2025-05-26T20:00:00+01:00","dateModified":"2025-05-26T20:00:00+01:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://grohee.fr/posts/argocd/"},"publisher":{"@type":"Organization","name":"grohee","logo":{"@type":"ImageObject","url":"https://grohee.fr/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://grohee.fr/ accesskey=h title="grohee (Alt + H)">grohee</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://grohee.fr/categories/ title=Catégories><span>Catégories</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://grohee.fr/>Home</a>&nbsp;»&nbsp;<a href=https://grohee.fr/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Argo CD et GitOps : automatiser le déploiement Kubernetes</h1><div class=post-meta><span title='2025-05-26 20:00:00 +0100 +0100'>May 26, 2025</span>&nbsp;·&nbsp;3134 words</div></header><figure class=entry-cover><img loading=eager src=https://grohee.fr/images/argocd.png alt="Argo CD"><figcaption>Argo CD</figcaption></figure><div class=post-content><p><strong>Argo CD</strong> est un outil de déploiement continu spécifiquement conçu pour les environnements <strong>Kubernetes</strong>. Fonctionnant selon le principe du <strong>GitOps</strong>, il permet de simplifier et d&rsquo;automatiser le déploiement d&rsquo;applications et la gestion d&rsquo;infrastructures conteneurisées en s&rsquo;appuyant sur des dépôts <strong>Git</strong> comme source de vérité.</p><h2 id=le-gitops>Le GitOps<a hidden class=anchor aria-hidden=true href=#le-gitops>#</a></h2><p>C&rsquo;est une méthodologie liée au déploiement d&rsquo;applications et à la gestion automatisée d&rsquo;infrastructure. Elle consiste à gérer l&rsquo;infrastructure en tant que code, sous forme de fichiers (souvent au format <code>YAML</code>) stockés dans des dépôts git utilisés comme <strong>source de vérité</strong>. L&rsquo;intérêt est de garantir que l&rsquo;état de l&rsquo;infrastructure et des applications est toujours en phase avec la configuration définie dans le dépôt.</p><p>Il existe plusieurs &ldquo;modes&rdquo; de GitOps nommés <strong>push</strong> et <strong>pull</strong> :</p><ul><li><strong>Mode push</strong> : Cas où c&rsquo;est la modification du référentiel qui provoque la livraison d&rsquo;une nouvelle configuration afin de placer l&rsquo;infrastructure dans l&rsquo;état souhaité. Par exemple, une pipeline (Jenkins, GitLab CI…) déclenche l&rsquo;application de la configuration après une modification dans Git.</li><li><strong>Mode pull</strong> : un agent (ex : Argo CD, Flux) scrute le dépôt Git en continu et applique les changements dès qu&rsquo;ils sont détectés. Les modifications sont apportées automatiquement par l&rsquo;outil sans autre intervention humaine que la modification du référentiel.</li></ul><p><strong>Remarques</strong> :</p><ul><li>Le<strong>GitOps</strong> ne remplace pas l&rsquo;usage d&rsquo;une <strong>CI</strong> classique pour les étapes de test ou de build d&rsquo;images, il s&rsquo;agit plutôt d&rsquo;une approche de <strong>Déploiement Continu</strong> (CD).</li><li>L&rsquo;approche <strong>pull</strong> est plus robuste, mieux adaptée à Kubernetes, et permet une synchronisation continue sans intervention manuelle.</li></ul><p><strong>Important</strong> : Dans une approche <strong>pull</strong> l&rsquo;utilisation des fonctionnalités de <strong>Merge Request</strong> afin d&rsquo;effectuer une relecture et une validation des modifications est recommandée.</p><h2 id=argo-cd--principes-et-fonctionnalités>Argo CD : principes et fonctionnalités<a hidden class=anchor aria-hidden=true href=#argo-cd--principes-et-fonctionnalités>#</a></h2><p><strong>Argo CD</strong> est un outil de la catégorie <strong>pull</strong>. Il permet de gérer le déploiement d&rsquo;applications et la configuration de clusters <strong>Kubernetes</strong> en se basant sur diverses sources : <strong>Git</strong>, <strong>Helm</strong> ou encore <strong>Kustomize</strong>.</p><p><strong>Son principe de fonctionnement est le suivant</strong> : il scrute en permanence les dépôts <strong>Git</strong> enregistrés en tant que sources afin de détecter des modifications et appliquer automatiquement les changements correspondant à la configuration du cluster <strong>Kubernetes</strong> et des applications qu&rsquo;il héberge.</p><h3 id=fonctionnalités>Fonctionnalités<a hidden class=anchor aria-hidden=true href=#fonctionnalités>#</a></h3><ul><li><strong>Déploiement & synchronisation</strong> : Argo déploie les ressources sur le cluster <strong>Kubernetes</strong> en se basant sur la configuration définie dans le dépôt <strong>Git</strong>. Il s&rsquo;assure que l&rsquo;état du cluster correspond à l&rsquo;état souhaité défini dans le dépôt en intéragissant avec l&rsquo;API <strong>Kubernetes</strong>.</li><li><strong>Custom Resource Definitions (CRD)</strong> : Argo CD intègre ses propres ressources personnalisées (CRD) pour gérer l&rsquo;ensemble des configurations de l&rsquo;outil en tant que code. Quelques exemples de CRD :<ul><li><code>Application</code> : représente une application déployée sur le cluster.</li><li><code>AppProject</code> : permet de définir des projets d&rsquo;application, facilitant la gestion des autorisations et des ressources.</li><li><code>ApplicationSet</code> : permet de déployer plusieurs applications à partir d&rsquo;un modèle ou d&rsquo;une configuration commune.</li></ul></li><li><strong>UI Web</strong> : interface web intuitive pour visualiser l&rsquo;état des applications, gérer les déploiements, effectuer des opérations de synchronisation et même consulter les logs des pods.</li><li><strong>Authentification et SSO</strong> : Argo CD prend en charge plusieurs méthodes d&rsquo;authentification, y compris l&rsquo;intégration avec des systèmes d&rsquo;authentification tiers via <strong>OpenID Connect (OIDC)</strong> ou <strong>LDAP</strong>.</li><li><strong>Gestion des accès</strong> : Argo CD embarque un système de gestion de permissions basé sur les rôles (RBAC) permettant de contrôler l&rsquo;accès aux ressources et aux fonctionnalités de l&rsquo;outil.</li><li><strong>Métriques et alertes</strong> : Argo CD expose des métriques <strong>Prometheus</strong> pour surveiller l&rsquo;état des applications et des clusters. Il est possible de configurer des alertes basées sur ces métriques.</li><li><strong>Gestion multi-cluster</strong> : possibilité de gérer plusieurs clusters <strong>Kubernetes</strong> à partir d&rsquo;une seule instance, facilitant ainsi la gestion d&rsquo;environnements complexes.</li><li>Intégration avec des <strong>Webhooks</strong> : Argo CD peut être configuré pour recevoir des notifications de changements dans les dépôts <strong>Git</strong> via des <strong>webhooks</strong>, permettant ainsi une synchronisation instantanée des modifications.</li><li><strong>Gestion des secrets</strong> : gestion des secrets Kubernetes</li></ul><h3 id=fonctionnement-et-architecture>Fonctionnement et architecture<a hidden class=anchor aria-hidden=true href=#fonctionnement-et-architecture>#</a></h3><p><strong>Argo CD</strong> est un ensemble de composants qui sont déployés sur le cluster <strong>Kubernetes</strong> sous forme de microservices. Voici les principaux composants et leur fonction :</p><ul><li><p><strong>L’API Server</strong> :</p><ul><li>Expose l&rsquo;API utilisée par l&rsquo;interface web et la CLI d&rsquo;ArgoCD</li><li>Gestion des applications et la récupération de leur statut</li><li>Exécution des opérations telles que la synchronisation, le retour en arrière et les actions définies par l&rsquo;utilisateur</li><li>Gestion des identifiants des dépôts et des clusters, qui sont stockés en tant que <code>Secrets</code> <strong>Kubernetes</strong></li></ul></li><li><p><strong>Le Repository Server</strong> :</p><ul><li>Stocke les informations sur les dépôts git: URL, version, chemin vers la définition de l&rsquo;application</li><li>Mise en cache des manifestes d&rsquo;application pour une récupération rapide</li></ul></li><li><p><strong>L’Application Controller</strong> :</p><ul><li>Surveille l&rsquo;état des applications déployées sur le cluster</li><li>Compare l&rsquo;état actuel des applications à l&rsquo;état cible défini dans le dépôt</li><li>Prend des mesures correctives en cas de détection d&rsquo;états OutOfSync ou de changement dans la source (via le controller manager de K8s)</li><li>Gère les événements définis par l&rsquo;utilisateur relatifs au cycle de vie de l’application (PreSync, Sync et PostSync)</li></ul></li></ul><p>D&rsquo;autres composants sont présents comme <strong>l&rsquo;application set controller</strong> pour la gestion des ressources du même nom, ou <strong>dex</strong> pour la gestion des utilisateurs et de l&rsquo;authentification.</p><h3 id=avantages>Avantages<a hidden class=anchor aria-hidden=true href=#avantages>#</a></h3><ul><li>Centralisation des configurations dans un référentiel unique (git)</li><li>Versionning des configurations d’infrastructure et possibilité de revenir à une version antérieure en cas de problème</li><li>Garantit la cohérence entre l&rsquo;état réel et l&rsquo;état souhaité de l&rsquo;infrastructure</li><li>Éviter les modifications manuelles non tracées</li><li>Fiabilisation des déploiements et limitation des erreurs humaines</li><li>Aperçu de l&rsquo;ensemble des ressources déployées dans le cluster via l&rsquo;interface web</li></ul><h2 id=installation>Installation<a hidden class=anchor aria-hidden=true href=#installation>#</a></h2><h3 id=méthode-de-base>Méthode de base<a hidden class=anchor aria-hidden=true href=#méthode-de-base>#</a></h3><p>La première manière d&rsquo;insaller <strong>Argo CD</strong> est de le déployer en suivant la documentation officielle.</p><p>Pour cela, il suffit d&rsquo;appliquer le fichier <strong>manifest</strong> fournit par la documentation dans un <code>namespace</code> dédié :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl create namespace argocd
</span></span><span style=display:flex><span>kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml
</span></span></code></pre></div><p>Une fois installé, il suffit de faire un <code>port-forward</code> sur le service <code>argocd-server</code> pour accéder à l&rsquo;interface web :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl port-forward svc/argocd-server -n argocd 8080:443 --address 0.0.0.0
</span></span></code></pre></div><p>Une fois connecté sur l&rsquo;interface web, il est possible de se connecter avec le nom d&rsquo;utilisateur <code>admin</code> et le mot de passe par défaut qu&rsquo;il est possible d&rsquo;obtenir via la commande suivante :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl -n argocd get secret argocd-initial-admin-secret -o jsonpath<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;{.data.password}&#34;</span> | base64 -d
</span></span></code></pre></div><h3 id=installation-via-helm>Installation via Helm<a hidden class=anchor aria-hidden=true href=#installation-via-helm>#</a></h3><p>Dans le cas d&rsquo;un environnement <strong>Kubernetes</strong> en production, il est souvent plus propre de déployer les ressources via un <strong>chart Helm</strong>. Il existe un grand nombre de charts pour tout type de services, et <strong>Argo CD</strong> n&rsquo;échappe pas à la règle.</p><p>L&rsquo;installation via <strong>Helm</strong> s&rsquo;effectue avec les commandes suivantes :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm repo add argo https://argoproj.github.io/argo-helm <span style=color:#75715e># Ajout du dépôt Helm d&#39;Argo</span>
</span></span><span style=display:flex><span>helm install my-argo-cd argo/argo-cd -n argocd --create-namespace <span style=color:#75715e># Installation d&#39;Argo dans le namespace</span>
</span></span></code></pre></div><p><strong>Remarque</strong> : il peut être nécessaire de fixer la version du chart à installer en ajoutant <code>--version &lt;version></code> à la commande <code>helm install</code> dans le cas d&rsquo;environnements de production, afin d&rsquo;éviter les changements de comportement suite à une mise à jour du chart.</p><p><strong>Astuce</strong> : si le dépôt <strong>Helm</strong> n&rsquo;est pas déte, utiliser <code>helm repo update</code>.</p><p>Dans le cas d&rsquo;une installation par <strong>Helm</strong>, il est possible de personnaliser la configuration de l&rsquo;outil dès l&rsquo;installation via des <strong>values</strong>.</p><p>Par exemple, il est possible de désactiver <strong>tls</strong> sur le serveur <strong>argocd-server</strong> :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>configs</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>params</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>server.insecure</span>: <span style=color:#e6db74>&#34;true&#34;</span>
</span></span></code></pre></div><p>Ces éléments sont à ajouter dans un fichier <code>values.yaml</code> et à passer lors de l&rsquo;installation :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>helm install my-argo-cd argo/argo-cd -n argocd --create-namespace -f values.yaml
</span></span></code></pre></div><p>L&rsquo;ensemble des valeurs configurables sont détaillées dans le dépôt git du projet <a href=https://github.com/argoproj/argo-helm/blob/main/charts/argo-cd/values.yaml>argo-helm</a>.</p><p><strong>Remarque</strong> : pour avoir un déploiement totalement automatisé et reproductible, il est possible d&rsquo;utiliser le <a href=https://registry.terraform.io/providers/hashicorp/helm/latest/docs>provider Helm</a> pour <strong>Terraform</strong>.</p><h2 id=configuration>Configuration<a hidden class=anchor aria-hidden=true href=#configuration>#</a></h2><p><strong>Argo CD</strong> est un outil complet et riche en fonctionnalités : authentification, gestion des accès, gestion d&rsquo;utilisateurs, gestion des applications, monitoring, etc.</p><h3 id=authentification>Authentification<a hidden class=anchor aria-hidden=true href=#authentification>#</a></h3><p><strong>Argo CD</strong> propose une grande variété de méthodes d&rsquo;authentifications, allant de l&rsquo;authentification basique (nom d&rsquo;utilisateur et mot de passe) à l&rsquo;intégration de <strong>OpenID Connect</strong> (OIDC) pour une authentification unique (SSO) avec des fournisseurs d&rsquo;identité tels que <strong>Google</strong>, <strong>GitHub</strong>, <strong>Keycloak</strong>, <strong>LDAP</strong>, etc.</p><p>La plupart de ces fonctionnalités sont offertes par <a href=https://dexidp.io/>dex</a> qui est un composant open source permettant de gérer l&rsquo;authentification des utilisateurs.</p><h4 id=ldap>LDAP<a hidden class=anchor aria-hidden=true href=#ldap>#</a></h4><p>Il est possible de configurer <strong>Argo CD</strong> pour utiliser un annuaire <strong>LDAP</strong> afin d&rsquo;y authentifier les utilisateurs et de gérer les groupes d&rsquo;utilisateurs.</p><p><strong>Exemple de configuration pour le connecteur LDAP</strong> :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>data</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>dex.config</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    connectors:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    - type: ldap
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      name: LDAP
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      id: ldap
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      config:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        # Ldap server address
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        host: &#34;&lt;LDAP_URL&gt;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        insecureNoSSL: true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        insecureSkipVerify: true
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        # Variable name stores ldap bindDN in argocd-secret
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        bindDN: &#34;$dex.ldap.bindDN&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        # Variable name stores ldap bind password in argocd-secret
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        bindPW: &#34;$dex.ldap.bindPW&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        usernamePrompt: Username
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        # Ldap user search attributes
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        userSearch:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          baseDN: &#34;&lt;LDAP_USER_BASE_DN&gt;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          filter: &#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          username: sAMAccountName
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          idAttr: sAMAccountName
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          emailAttr: mail
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          nameAttr: givenName
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        # Ldap group search attributes
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        groupSearch:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          baseDN: &#34;&lt;LDAP_GROUP_BASE_DN&gt;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          filter: &#34;(objectClass=group)&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          userAttr: DN
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          groupAttr: member
</span></span></span><span style=display:flex><span><span style=color:#e6db74>          nameAttr: cn</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>url</span>: <span style=color:#ae81ff>https://&lt;YOUR_ARGOCD_URL&gt;</span>
</span></span></code></pre></div><p>L&rsquo;utilisation du connecteur <strong>LDAP</strong> de dex (<a href=https://dexidp.io/docs/connectors/ldap/>Documentation dex</a>) permet de configurer les paramètres de connexion à l&rsquo;annuaire <strong>LDAP</strong>, les attributs des utilisateurs et des groupes, ainsi que les filtres de recherche (pour par exemple autoriser uniquement certains groupes d&rsquo;utilisateurs à se connecter à <strong>Argo CD</strong>).</p><h4 id=openid-connect-oidc>OpenID Connect (OIDC)<a hidden class=anchor aria-hidden=true href=#openid-connect-oidc>#</a></h4><h5 id=google>Google<a hidden class=anchor aria-hidden=true href=#google>#</a></h5><p>Grâce à <strong>dex</strong>, il est possible de configurer <strong>Argo CD</strong> pour utiliser <strong>Google</strong> comme fournisseur d&rsquo;identité via <strong>OpenID Connect (OIDC)</strong>.</p><p><strong>Exemple de configuration</strong> :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>data</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>admin.enabled</span>: <span style=color:#e6db74>&#34;true&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>application.instanceLabelKey</span>: <span style=color:#ae81ff>argocd.argoproj.io/instance</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>dex.config</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    connectors:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    - config:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        issuer: https://accounts.google.com
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        clientID: &lt;google-client-id&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        clientSecret: &lt;google-client-secret&gt;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        redirectURI: https://&lt;YOUR_ARGOCD_URL&gt;/api/dex/callback
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      type: oidc
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      id: google
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      name: Google</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>exec.enabled</span>: <span style=color:#e6db74>&#34;false&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>oidc.tls.insecure.skip.verify</span>: <span style=color:#e6db74>&#34;true&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>server.rbac.log.enforce.enable</span>: <span style=color:#e6db74>&#34;false&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>statusbadge.enabled</span>: <span style=color:#e6db74>&#34;false&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>timeout.hard.reconciliation</span>: <span style=color:#ae81ff>0s</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>timeout.reconciliation</span>: <span style=color:#ae81ff>180s</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>url</span>: <span style=color:#ae81ff>https://&lt;YOUR_ARGOCD_URL&gt;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ConfigMap</span>
</span></span></code></pre></div><p><strong>Quelques points à noter</strong> :</p><ul><li>Le <code>clientID</code> et le <code>clientSecret</code> sont à récupérer dans la console de gestion des APIs de <strong>Google Cloud</strong>.</li><li>Le <code>redirectURI</code> doit correspondre à l&rsquo;URL de votre instance <strong>Argo CD</strong> suivi de <code>/api/dex/callback</code> (représente le point de terminaison de redirection pour l&rsquo;authentification OIDC).</li><li>Plusieurs fournisseurs d&rsquo;identité peuvent être configurés dans le même fichier de configuration <code>dex.config</code>.</li><li>La récupération des groupes d&rsquo;utilisateurs peut être configurée mais nécessite un compte de service avec une <strong>délégation au niveau de l&rsquo;organisation</strong> pour accéder aux groupes d&rsquo;utilisateurs dans <strong>Google Workspace</strong>.</li></ul><p><strong>Ressource</strong> :</p><ul><li><a href=https://dexidp.io/docs/connectors/oidc/>Connecteur OIDC - Documentation dex</a></li><li><a href=https://argo-cd.readthedocs.io/en/stable/operator-manual/user-management/google/#openid-connect-plus-google-groups-using-dex>Authentification avec Google - Argo CD</a></li></ul><h3 id=gestion-des-accès-et-permissions>Gestion des accès et permissions<a hidden class=anchor aria-hidden=true href=#gestion-des-accès-et-permissions>#</a></h3><p>Les fournisseurs d&rsquo;identité (ex : <strong>LDAP</strong>, <strong>OIDC</strong>) permettant la récupération des utilisateurs et des groupes, <strong>Argo CD</strong> permet à ses administrateurs de définir des rôles et des permissions pour contrôler l&rsquo;accès aux ressources et aux fonctionnalités de l&rsquo;outil.</p><p>Plusieurs fonctionnalités vont permettre de gérer les politiques <strong>RBAC</strong> (Role-Based Access Control) :</p><ul><li><strong>Projects</strong> : permettent de regrouper les applications et de définir des politiques globales pour toutes les applications d&rsquo;un projet.</li><li><strong>Roles</strong> : définissent les permissions accordées aux utilisateurs ou groupes d&rsquo;utilisateurs.</li><li><strong>Role Bindings</strong> : lient les rôles aux utilisateurs ou groupes d&rsquo;utilisateurs, leur accordant ainsi les permissions définies dans le rôle.</li><li><strong>Policies</strong> : définissent les règles d&rsquo;accès aux ressources et aux fonctionnalités d&rsquo;Argo CD, en fonction des rôles et des utilisateurs.</li></ul><h3 id=projets>Projets<a hidden class=anchor aria-hidden=true href=#projets>#</a></h3><p>Un projet dans <strong>Argo CD</strong> est une ressource qui se déclare d&rsquo;une manière similaire à une application. La différence réside évidemment dans le contenu de la ressource qui permet de :</p><ul><li>Définir les <code>namespaces</code> sources et destination autorisés pour les applications du projet</li><li>Définir les dépôts <strong>Git</strong> autorisés pour les applications du projet</li><li>Définir des rôles et permissions spécifiques au projet</li><li>Définir des <strong>fenêtres de maintenance</strong> pour les applications du projet :<ul><li>Permet de limiter les opérations de synchronisation pendant une période donnée (ex : pendant les heures de travail)</li><li>Utile pour éviter les modifications pendant des périodes critiques (ex : maintenance, déploiement de nouvelles versions)</li></ul></li><li>Autoriser ou restreindre l&rsquo;usage de certaines ressources Kubernetes (ex : <code>ConfigMap</code>, <code>Secret</code>, <code>ServiceAccount</code>, etc.) pour les applications du projet</li></ul><p><strong>Aperçu du contenu d&rsquo;un projet :</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>argoproj.io/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>AppProject</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>example-app-project</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>argocd</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>description</span>: <span style=color:#ae81ff>ArgoCD project for an example application</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>sourceRepos</span>:
</span></span><span style=display:flex><span>    - <span style=color:#e6db74>&#39;*&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>destinations</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>&lt;namespace_1&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>server</span>: <span style=color:#ae81ff>https://kubernetes.default.svc</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>&lt;namespace_2&gt;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>server</span>: <span style=color:#ae81ff>https://kubernetes.default.svc</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>namespace</span>: <span style=color:#e6db74>&#34;!kube-system&#34;</span> <span style=color:#75715e># Exclut le namespace kube-system</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>server</span>: <span style=color:#e6db74>&#34;*&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>clusterResourceWhitelist</span>: []
</span></span><span style=display:flex><span>    <span style=color:#f92672>clusterResourceBlacklist</span>: []
</span></span><span style=display:flex><span>    <span style=color:#f92672>namespaceResourceBlacklist</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>group</span>: <span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ResourceQuota</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>group</span>: <span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>LimitRange</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>group</span>: <span style=color:#e6db74>&#39;&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>NetworkPolicy</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>orphanedResources</span>: {}
</span></span><span style=display:flex><span>      <span style=color:#f92672>roles</span>: []
</span></span><span style=display:flex><span>    <span style=color:#f92672>namespaceResourceWhitelist</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>group</span>: <span style=color:#e6db74>&#39;apps&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Deployment</span>
</span></span><span style=display:flex><span>    - <span style=color:#f92672>group</span>: <span style=color:#e6db74>&#39;apps&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>StatefulSet</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>orphanedResources</span>: {}
</span></span><span style=display:flex><span>    <span style=color:#f92672>roles</span>: []
</span></span><span style=display:flex><span>    <span style=color:#f92672>syncWindows</span>: 
</span></span><span style=display:flex><span>    - <span style=color:#f92672>kind</span>: <span style=color:#ae81ff>allow</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>schedule</span>: <span style=color:#e6db74>&#39;10 1 * * *&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>duration</span>: <span style=color:#ae81ff>1h</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>applications</span>:
</span></span><span style=display:flex><span>      - <span style=color:#e6db74>&#39;*-prod&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>manualSync</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>signatureKeys</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>keyID</span>: <span style=color:#ae81ff>ABCDEF1234567890</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>sourceNamespaces</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>${argocd_namespace}</span>
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>${argocd_namespace}</span>
</span></span></code></pre></div><p><strong>Quelques explications</strong> :</p><ul><li><strong>orphanedResources</strong> : permet de définir les ressources orphelines (ressources qui ne sont plus gérées par Argo CD) à prendre en compte ou à ignorer lors de la synchronisation.</li><li><strong>signatureKeys</strong> : permet de définir les clés de signature utilisées pour vérifier l&rsquo;intégrité des applications déployées.</li></ul><p>Plus d&rsquo;informations dans la <a href=https://argo-cd.readthedocs.io/en/stable/user-guide/projects/>documentation de Argo CD</a>.</p><h4 id=les-politiques-de-sécurité>Les politiques de sécurité<a hidden class=anchor aria-hidden=true href=#les-politiques-de-sécurité>#</a></h4><p>Les politiques de sécurité dans <strong>Argo CD</strong> permettent de définir des règles d&rsquo;accès aux ressources et aux fonctionnalités de l&rsquo;outil. Elles sont définies dans le fichier de configuration <code>argocd-rbac-cm</code> dans le <code>namespace</code> <strong>argocd</strong>.</p><p>On va pouvoir attribuer des rôles par défaut tels que <code>admin</code> et <code>readonly</code>, mais aussi définir des rôles personnalisés.</p><p>Chaque <strong>ressource</strong> (ex : <code>Application</code>, <code>Project</code>, <code>ApplicationSet</code>, etc.) possède des permissions spécifiques qui peuvent être accordées ou restreintes aux utilisateurs et groupes d&rsquo;utilisateurs :</p><table><thead><tr><th>Ressource</th><th style=text-align:center>get</th><th style=text-align:center>create</th><th style=text-align:center>update</th><th style=text-align:center>delete</th><th style=text-align:center>sync</th><th style=text-align:center>action</th><th style=text-align:center>override</th><th style=text-align:center>invoke</th></tr></thead><tbody><tr><td>applications</td><td style=text-align:center>✅</td><td style=text-align:center>✅</td><td style=text-align:center>✅</td><td style=text-align:center>✅</td><td style=text-align:center>✅</td><td style=text-align:center>✅</td><td style=text-align:center>✅</td><td style=text-align:center>❌</td></tr><tr><td>applicationsets</td><td style=text-align:center>✅</td><td style=text-align:center>✅</td><td style=text-align:center>✅</td><td style=text-align:center>✅</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td></tr><tr><td>clusters</td><td style=text-align:center>✅</td><td style=text-align:center>✅</td><td style=text-align:center>✅</td><td style=text-align:center>✅</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td></tr><tr><td>projects</td><td style=text-align:center>✅</td><td style=text-align:center>✅</td><td style=text-align:center>✅</td><td style=text-align:center>✅</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td></tr><tr><td>repositories</td><td style=text-align:center>✅</td><td style=text-align:center>✅</td><td style=text-align:center>✅</td><td style=text-align:center>✅</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td></tr><tr><td>accounts</td><td style=text-align:center>✅</td><td style=text-align:center>❌</td><td style=text-align:center>✅</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td></tr><tr><td>certificates</td><td style=text-align:center>✅</td><td style=text-align:center>✅</td><td style=text-align:center>❌</td><td style=text-align:center>✅</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td></tr><tr><td>gpgkeys</td><td style=text-align:center>✅</td><td style=text-align:center>✅</td><td style=text-align:center>❌</td><td style=text-align:center>✅</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td></tr><tr><td>logs</td><td style=text-align:center>✅</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td></tr><tr><td>exec</td><td style=text-align:center>❌</td><td style=text-align:center>✅</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td></tr><tr><td>extensions</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td><td style=text-align:center>❌</td><td style=text-align:center>✅</td></tr></tbody></table><p><em>Tableau tiré de la <a href=https://argo-cd.readthedocs.io/en/stable/operator-manual/rbac/>documentation officielle</a></em></p><p>Dès lors, il est possible de définir des rôles et des permissions pour les utilisateurs et groupes en se basant sur ces différents types de droits pour chaque ressource.</p><p><strong>Exemple de définition de rôle</strong> :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>v1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ConfigMap</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>argocd-rbac-cm</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>argocd</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>labels</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>app.kubernetes.io/name</span>: <span style=color:#ae81ff>argocd-rbac-cm</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>app.kubernetes.io/part-of</span>: <span style=color:#ae81ff>argocd</span>
</span></span><span style=display:flex><span><span style=color:#f92672>data</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>policy.csv</span>: <span style=color:#ae81ff>|</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>p, role:developer, applications, *, my-project/*, allow</span> <span style=color:#75715e># Permet aux développeurs de gérer les applications de leur projet</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>p, role:developer, applications, get,*, allow</span> <span style=color:#75715e># Permet aux développeurs de récupérer les applications de tous les projets</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>p, role:developer, applicationsets, get,*, allow</span> <span style=color:#75715e># Permet aux développeurs de récupérer les ApplicationSets de tous les projets</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>p, role:developer, repositories, get,*, allow</span> <span style=color:#75715e># Permet aux développeurs de récupérer les dépôts de tous les projets</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>p, role:developer, projects, get,*, allow</span> <span style=color:#75715e># Permet aux développeurs de récupérer les projets de tous les projets</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>p, role:developer, clusters, get,*, allow</span> <span style=color:#75715e># Permet aux développeurs de récupérer les clusters de tous les projets</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>g, developer@example, role:developer</span> <span style=color:#75715e># Associe le groupe developer@example à ce rôle</span>
</span></span><span style=display:flex><span>    <span style=color:#ae81ff>g, user@example.org, role:admin</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>policy.default</span>: <span style=color:#ae81ff>role:readonly</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>scopes</span>: <span style=color:#e6db74>&#39;[groups, email]&#39;</span>
</span></span></code></pre></div><p><strong>Remarque</strong> : Un rôle par défaut peut être définir avec <code>policy.default</code> et sera appliqué à tous les utilisateurs qui ne sont pas explicitement associés à un rôle.</p><h3 id=monitoring>Monitoring<a hidden class=anchor aria-hidden=true href=#monitoring>#</a></h3><p><em>A venir</em></p><h2 id=déploiement-dapplications>Déploiement d&rsquo;applications<a hidden class=anchor aria-hidden=true href=#déploiement-dapplications>#</a></h2><h3 id=déployer-une-application-simple>Déployer une application simple<a hidden class=anchor aria-hidden=true href=#déployer-une-application-simple>#</a></h3><p><strong>Argo CD</strong> étant plutôt simple à utiliser, il est possible de déployer directement une application via l&rsquo;interface web.</p><p>On retrouve deux méthodes de définition d&rsquo;application :</p><ul><li>Via un formulaire web</li><li>Via un éditeur de texte permettant de définir l&rsquo;application en <strong>YAML</strong></li></ul><p>Ces éléments permettent de créer la ressource <code>Application</code> qui contient toutes les informations nécessaires au déploiement de l&rsquo;application, et à son suivi :</p><ul><li><strong>Source</strong> : dépôt <strong>Git</strong>, <strong>Helm</strong> ou <strong>Kustomize</strong>.</li><li><strong>Destination</strong> : cluster <strong>Kubernetes</strong> et namespace cible</li><li><strong>Sync Policy</strong> et <strong>Sync Options</strong> : stratégie de synchronisation (automatique ou manuelle) et options de synchronisation (ex : prune, self heal)</li><li><strong>Project</strong> : projet auquel l&rsquo;application appartient afin de gérer les accès et les ressources</li></ul><p>Concernant l&rsquo;utilisation de l&rsquo;interface web, les champs étant assez explicites, il est possible de créer une application en quelques clics.</p><p>Pour la création d&rsquo;une application via un fichier <strong>YAML</strong>, voici un exemple de définition d&rsquo;application :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>argoproj.io/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Application</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>some-app</span> <span style=color:#75715e># Nom de l&#39;application</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>argocd</span> <span style=color:#75715e># Namespace où la ressource application sera créée</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>project</span>: <span style=color:#ae81ff>default</span> <span style=color:#75715e># Projet par défaut</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>source</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>repoURL</span>: <span style=color:#ae81ff>https://github.com/example-org/gitops-demo</span> <span style=color:#75715e># URL du dépôt</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>targetRevision</span>: <span style=color:#ae81ff>main</span> <span style=color:#75715e># Branche</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>path</span>: <span style=color:#ae81ff>apps/</span> <span style=color:#75715e># Chemin vers les fichiers de configuration</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>destination</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>server</span>: <span style=color:#ae81ff>https://kubernetes.default.svc</span> <span style=color:#75715e># URL de l&#39;API du cluster (ici le cluster par défaut)</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>app</span> <span style=color:#75715e># Namespace cible</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>syncPolicy</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>automated</span>: <span style=color:#75715e># Synchronisation automatique</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>prune</span>: <span style=color:#66d9ef>true</span> <span style=color:#75715e># Prune les ressources non définies dans le dépôt (supprime les ressources non gérées par Argo CD)</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>selfHeal</span>: <span style=color:#66d9ef>true</span> <span style=color:#75715e># Auto-réparation des ressources</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>syncOptions</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>CreateNamespace=true</span>
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>PruneLast=true</span> <span style=color:#75715e># Prune les ressources après la synchronisation</span>
</span></span></code></pre></div><p>Il est possible d&rsquo;utiliser des <strong>charts Helm</strong> comme source d&rsquo;application. Dans ce cas, il faut ajouter la section <code>helm</code> dans la définition de l&rsquo;application :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>argoproj.io/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>Application</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>kubernetes-dashboard</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>argocd</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>project</span>: <span style=color:#ae81ff>default</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>source</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>chart</span>: <span style=color:#ae81ff>kubernetes-dashboard</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>repoURL</span>: <span style=color:#ae81ff>https://kubernetes.github.io/dashboard/</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>targetRevision</span>: <span style=color:#ae81ff>7.10.0</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>helm</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>releaseName</span>: <span style=color:#ae81ff>kubernetes-dashboard</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>values</span>: |<span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>        kong.admin.tls.enabled: false</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>destination</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>server</span>: <span style=color:#e6db74>&#34;https://kubernetes.default.svc&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>monitoring</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>syncPolicy</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>syncOptions</span>: 
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>CreateNamespace=true</span>
</span></span></code></pre></div><p>La personnalisation des <strong>values</strong> du <strong>chart Helm</strong> peut se faire de plusieurs manières :</p><ul><li>En utilisant la section <code>values</code> ou <code>valuesObject</code> dans la définition de l&rsquo;application (comme ci-dessus)</li><li>En utilisant un fichier <strong>YAML</strong> externe (ex : <code>values.yaml</code>) en l&rsquo;ajoutant dans la section <code>valuesFiles</code>.</li></ul><p>Plus d&rsquo;informations sont disponibles dans la section <a href=https://argo-cd.readthedocs.io/en/stable/user-guide/helm/>Helm</a> de la documentation.</p><h3 id=déployer-plusieurs-applications>Déployer plusieurs applications<a hidden class=anchor aria-hidden=true href=#déployer-plusieurs-applications>#</a></h3><h4 id=app-of-apps>App of Apps<a hidden class=anchor aria-hidden=true href=#app-of-apps>#</a></h4><p>Bien qu&rsquo;il soit possible d&rsquo;utiliser l&rsquo;interface web pour créer chaque application une à une, il est préférable de le faire via des fichiers <strong>YAML</strong> stockés dans un dépôt <strong>Git</strong>. Cela permet de versionner la configuration des applications et de les gérer comme n&rsquo;importe quelle autre ressource <strong>Kubernetes</strong>.</p><p>Ce type d&rsquo;implémentation est appelé <strong>App of Apps</strong>, c&rsquo;est à dire qu&rsquo;à partir d&rsquo;une application Argo CD, une multitudes d&rsquo;autres applications seront déployées car définies dans des fichiers <strong>YAML</strong> stockés dans un dépôt <strong>Git</strong> scruté par l&rsquo;application racine.</p><h4 id=applicationset>ApplicationSet<a hidden class=anchor aria-hidden=true href=#applicationset>#</a></h4><p>Une autre solution pour déployer plusieurs applications est d&rsquo;utiliser un <strong>ApplicationSet</strong>. Il s&rsquo;agit d&rsquo;une ressource permettant de définir des <strong>templates</strong> d&rsquo;applications et de générer plusieurs applications à partir de ceux-ci.</p><p>On va pouvoir les utiiliser dans plusieurs cas :</p><ul><li>Déployer plusieurs instances d&rsquo;une même application avec des configurations différentes (ex : différents environnements)</li><li>Déployer des applications à partir de modèles définis dans un dépôt <strong>Git</strong></li><li>Déployer des applications dans plusieurs clusters</li></ul><p><strong>Exemple d&rsquo;ApplicationSet basé sur un dépôt Git</strong> :</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>apiVersion</span>: <span style=color:#ae81ff>argoproj.io/v1alpha1</span>
</span></span><span style=display:flex><span><span style=color:#f92672>kind</span>: <span style=color:#ae81ff>ApplicationSet</span>
</span></span><span style=display:flex><span><span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>name</span>: <span style=color:#ae81ff>apps-by-dir</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>namespace</span>: <span style=color:#ae81ff>argocd</span>
</span></span><span style=display:flex><span><span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>generators</span>:
</span></span><span style=display:flex><span>    - <span style=color:#f92672>git</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>repoURL</span>: <span style=color:#ae81ff>https://github.com/mon-org/mon-repo.git</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>revision</span>: <span style=color:#ae81ff>main</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>directories</span>:
</span></span><span style=display:flex><span>          - <span style=color:#f92672>path</span>: <span style=color:#ae81ff>apps/*</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>metadata</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>name</span>: <span style=color:#e6db74>&#39;{{path.basename}}&#39;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>spec</span>:
</span></span><span style=display:flex><span>      <span style=color:#f92672>project</span>: <span style=color:#ae81ff>default</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>source</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>repoURL</span>: <span style=color:#ae81ff>https://github.com/mon-org/mon-repo.git</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>targetRevision</span>: <span style=color:#ae81ff>main</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>path</span>: <span style=color:#e6db74>&#39;{{path}}&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>destination</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>server</span>: <span style=color:#ae81ff>https://kubernetes.default.svc</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>namespace</span>: <span style=color:#e6db74>&#39;{{path.basename}}&#39;</span>
</span></span><span style=display:flex><span>      <span style=color:#f92672>syncPolicy</span>:
</span></span><span style=display:flex><span>        <span style=color:#f92672>automated</span>:
</span></span><span style=display:flex><span>          <span style=color:#f92672>prune</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>          <span style=color:#f92672>selfHeal</span>: <span style=color:#66d9ef>true</span>
</span></span></code></pre></div><p>De nombreux générateurs sont disponibles pour l&rsquo;<code>ApplicationSet</code> et sont détaillés dans la <a href=https://argo-cd.readthedocs.io/en/stable/operator-manual/applicationset/>documentation officielle</a>.</p><h3 id=gestion-des-secrets>Gestion des secrets<a hidden class=anchor aria-hidden=true href=#gestion-des-secrets>#</a></h3><p><em>A venir</em></p><h2 id=références>Références<a hidden class=anchor aria-hidden=true href=#références>#</a></h2><ul><li><a href=https://argo-cd.readthedocs.io/en/stable/>Documentation officielle d&rsquo;Argo CD</a></li><li><a href=https://une-tasse-de.cafe/blog/argocd/>ArgoCD de A à Y - Une tasse de café</a></li><li><a href=https://blog.wescale.fr/flux-et-argocd-deux-visions-du-gitops-sur-kubernetes>Flux et ArgoCD, deux visions du GitOps sur Kubernetes - WeScale</a></li><li><a href=https://www.redhat.com/fr/topics/devops/what-is-argocd>Argo CD, qu&rsquo;est-ce que c&rsquo;est ? - Red Hat</a></li><li><a href="https://www.youtube.com/watch?v=MeU5_k9ssrs">ArgoCD Tutorial for Beginners | GitOps CD for Kubernetes - TechWorld with Nana</a></li></ul></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://grohee.fr/>grohee</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>